{% load static %}
{% include 'Nucleo/arriba.html' %}

{% block extra_css %}
<!-- Select2 CSS -->
<link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
<style>
    .progress-description a {
        display: inline-block;
        margin-top: 5px;
        font-size: 0.85rem;
        color: white !important;
        opacity: 0.9;
        transition: all 0.2s;
    }

    .progress-description a:hover {
        opacity: 1;
        text-decoration: none;
        transform: translateX(3px);
    }

    .hover-shadow {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-shadow:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2) !important;
    }

    @keyframes pulse {

        0%,
        100% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.1);
        }
    }

    @keyframes swing {

        0%,
        100% {
            transform: rotate(0deg);
        }

        25% {
            transform: rotate(5deg);
        }

        75% {
            transform: rotate(-5deg);
        }
    }

    @keyframes tada {
        0% {
            transform: scale(1) rotate(0deg);
        }

        10%,
        20% {
            transform: scale(0.9) rotate(-3deg);
        }

        30%,
        50%,
        70%,
        90% {
            transform: scale(1.1) rotate(3deg);
        }

        40%,
        60%,
        80% {
            transform: scale(1.1) rotate(-3deg);
        }

        100% {
            transform: scale(1) rotate(0deg);
        }
    }

    @keyframes bounce {

        0%,
        20%,
        50%,
        80%,
        100% {
            transform: translateY(0);
        }

        40% {
            transform: translateY(-10px);
        }

        60% {
            transform: translateY(-5px);
        }
    }

    .info-box-icon.pulse {
        animation: pulse 2s infinite;
    }

    .info-box-icon.swing {
        animation: swing 2s infinite;
    }

    .info-box-icon.tada {
        animation: tada 2s infinite;
    }

    .info-box-icon.bounce {
        animation: bounce 2s infinite;
    }

    /* Estilos para la sección de accesos rápidos */
    .content-section {
        background-color: #f4f6f9;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .content-section h4 {
        color: #495057;
        font-weight: 600;
        transition: color 0.3s ease;
    }

    .content-section .text-muted {
        font-size: 0.9rem;
        margin-bottom: 15px;
        transition: color 0.3s ease;
    }

    /* Estilos para modo oscuro */
    body.dark-mode .content-section {
        background-color: #1e1e2e;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        border: 1px solid #2d2d44;
    }

    body.dark-mode .content-section h4 {
        color: #e0e0e0;
    }

    body.dark-mode .content-section .text-muted {
        color: #b0b0b0 !important;
    }
</style>
{% endblock %}

{% include 'Nucleo/centro.html' %}

{% block content %}
<section class="content">
    <div class="container-fluid">
        <!-- Mensajes -->
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
        {% endif %}

        <!-- Bienvenida -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="callout callout-info">
                    <h5><i class="fas fa-user"></i> Bienvenido, {{ nombre_usuario|default:user.username }}!</h5>
                    <p>Este es tu panel de control. Aquí puedes acceder a las funciones disponibles según tus permisos.
                    </p>
                    {% if user.is_superuser %}
                    <p class="mb-0"><strong>Rol:</strong> Superusuario (acceso completo al sistema)</p>
                    {% else %}
                    <p class="mb-0">
                        <strong>Roles asignados:</strong>
                        {% for grupo in user.groups.all %}
                        <span class="badge badge-primary">{{ grupo.name }}</span>
                        {% empty %}
                        <span class="text-muted">Sin roles asignados</span>
                        {% endfor %}
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sección de Accesos Rápidos -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="callout callout-info">
                    <section class="content">
                        <div class="container-fluid">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h4 class="mb-0"><i class="fas fa-th-large"></i> Accesos Rápidos</h4>
                                            <p class="text-muted mb-0">Selecciona una opción para acceder a las
                                                funciones disponibles</p>
                                        </div>
                                        {% if can_add_proyectos or can_add_repositorio or can_add_publicaciones or user.is_superuser %}
                                        <button type="button" class="btn btn-success btn-lg" id="btnWizardRapido"
                                            data-toggle="modal" data-target="#modalWizardRapido">
                                            <i class="fas fa-magic"></i> Wizard Rápido
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Cards de opciones según rol -->
                            <div class="row">
                                <!-- Acceso público siempre visible -->
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-primary shadow-lg hover-shadow">
                                        <span class="info-box-icon"><i class="fas fa-globe-americas"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Catálogo Público</span>
                                            <span class="info-box-number">Explorar</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'catalogo_publico:index' %}" class="text-white"
                                                    target="_blank" rel="noopener noreferrer">
                                                    Ver Proyectos Públicos <i
                                                        class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card para Catalogación -->
                                {% if can_view_catalogacion %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-primary shadow-lg hover-shadow">
                                        <span class="info-box-icon pulse"><i class="fas fa-tags"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Catalogación</span>
                                            <span class="info-box-number">
                                                {% if can_add_catalogacion %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'catalogacion:index' %}" class="text-white">
                                                    Categorías y Etiquetas <i
                                                        class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Proyectos -->
                                {% if can_view_proyectos %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-danger shadow-lg hover-shadow">
                                        <span class="info-box-icon tada"><i class="fas fa-project-diagram"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Proyectos</span>
                                            <span class="info-box-number">
                                                {% if can_add_proyectos %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'proyectos:index' %}" class="text-white">
                                                    Gestionar Proyectos <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Repositorio -->
                                {% if can_view_repositorio %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-success shadow-lg hover-shadow">
                                        <span class="info-box-icon bounce"><i class="fas fa-archive"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Repositorio</span>
                                            <span class="info-box-number">
                                                {% if can_add_repositorio %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'repositorio:index' %}" class="text-white">
                                                    Gestionar Repositorio <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Publicaciones -->
                                {% if can_view_publicaciones %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-warning shadow-lg hover-shadow">
                                        <span class="info-box-icon swing"><i class="fas fa-book"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Publicaciones</span>
                                            <span class="info-box-number">
                                                {% if can_add_publicaciones %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'publicaciones:index' %}" class="text-white">
                                                    Gestionar Publicaciones <i
                                                        class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Interacción -->
                                {% if can_view_interaccion %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-secondary shadow-lg hover-shadow">
                                        <span class="info-box-icon tada"><i class="fas fa-comments"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Interacción</span>
                                            <span class="info-box-number">
                                                {% if can_add_interaccion %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'interaccion:index' %}" class="text-white">
                                                    Gestionar Interacción <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Notificaciones -->
                                {% if can_view_notificaciones %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-info shadow-lg hover-shadow">
                                        <span class="info-box-icon bounce"><i class="fas fa-bell"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Notificaciones</span>
                                            <span class="info-box-number">
                                                {% if can_add_notificaciones %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'notificaciones:index' %}" class="text-white">
                                                    Gestionar Notificaciones <i
                                                        class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Configuración -->
                                {% if can_view_configuracion %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-dark shadow-lg hover-shadow">
                                        <span class="info-box-icon pulse"><i class="fas fa-cog"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Configuración</span>
                                            <span class="info-box-number">
                                                {% if can_add_configuracion %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'configuracion:index' %}" class="text-white">
                                                    Gestionar Configuración <i
                                                        class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Metadatos -->
                                {% if can_view_metadatos %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-purple shadow-lg hover-shadow">
                                        <span class="info-box-icon swing"><i class="fas fa-layer-group"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Metadatos</span>
                                            <span class="info-box-number">
                                                {% if can_add_metadatos %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'metadatos:index' %}" class="text-white">
                                                    Gestionar Metadatos <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Estadísticas -->
                                {% if can_view_estadisticas %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-success shadow-lg hover-shadow">
                                        <span class="info-box-icon pulse"><i class="fas fa-chart-bar"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Estadísticas</span>
                                            <span class="info-box-number">
                                                {% if can_add_estadisticas %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'estadisticas:index' %}" class="text-white">
                                                    Ver Estadísticas <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Búsqueda -->
                                {% if can_view_busqueda %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-warning shadow-lg hover-shadow">
                                        <span class="info-box-icon swing"><i class="fas fa-search"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Búsqueda</span>
                                            <span class="info-box-number">
                                                {% if can_add_busqueda %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'busqueda:index' %}" class="text-white">
                                                    Gestionar Búsqueda <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para Revisiones -->
                                {% if can_view_revisiones %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-danger shadow-lg hover-shadow">
                                        <span class="info-box-icon pulse"><i class="fas fa-clipboard-check"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Revisiones</span>
                                            <span class="info-box-number">
                                                {% if can_add_revisiones %}Gestión{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'revisiones:index' %}" class="text-white">
                                                    Gestionar Revisiones <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Card para usuarios con permiso de ver usuarios -->
                                {% if can_view_usuarios %}
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-primary shadow-lg hover-shadow">
                                        <span class="info-box-icon pulse"><i class="fas fa-users"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Usuarios</span>
                                            <span class="info-box-number">
                                                {% if user.is_superuser %}Admin{% else %}Ver{% endif %}
                                            </span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'usuarios:lista_usuarios' %}" class="text-white">
                                                    Ver usuarios <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                {% if can_manage_roles %}
                                <!-- Opciones adicionales para superusuario -->
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-warning shadow-lg hover-shadow">
                                        <span class="info-box-icon tada"><i class="fas fa-users-cog"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Gestión de Roles</span>
                                            <span class="info-box-number">Admin</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'usuarios:lista_grupos' %}" class="text-white">
                                                    Ver roles <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Opciones disponibles para todos los usuarios autenticados -->
                                <div class="col-12 col-sm-6 col-lg-3 mb-4">
                                    <div class="info-box bg-gradient-success shadow-lg hover-shadow">
                                        <span class="info-box-icon swing"><i class="fas fa-user-circle"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Mi Perfil</span>
                                            <span class="info-box-number">Perfil</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-white" style="width: 100%"></div>
                                            </div>
                                            <span class="progress-description">
                                                <a href="{% url 'usuarios:perfil' %}" class="text-white">
                                                    Ver perfil <i class="fas fa-arrow-circle-right ml-1"></i>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
        <!-- Información adicional para usuarios regulares -->
        {% if not user.is_superuser %}
        <div class="row">
            <div class="col-12">
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-info-circle"></i> Información</h3>
                    </div>
                    <div class="card-body">
                        <p>Tu cuenta tiene acceso limitado según los roles que te han sido asignados.</p>
                        <p class="mb-0">Si necesitas acceso a funciones adicionales, contacta con un administrador del
                            sistema.</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Modal Wizard Rápido -->
<div class="modal fade" id="modalWizardRapido" tabindex="-1" role="dialog" aria-labelledby="modalWizardRapidoLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="modalWizardRapidoLabel">
                    <i class="fas fa-magic"></i> Wizard Rápido - Crear Documento, Archivo, Proyecto y Publicación
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Progress Bar -->
                <div class="progress mb-4" style="height: 30px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                        id="wizardProgress" style="width: 33.33%">
                        Paso 1 de 3
                    </div>
                </div>

                <!-- Wizard Steps -->
                <form id="formWizardRapido">
                    {% csrf_token %}

                    <!-- Paso 1: Documento con PDF -->
                    <div class="wizard-step" id="step1" data-step="1">
                        <h5 class="mb-3"><i class="fas fa-file"></i> Paso 1: Crear Documento con PDF</h5>
                        <div class="form-group">
                            <label for="wizardTitulo">Título del Documento <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="wizardTitulo" name="titulo" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardTipoRecurso">Tipo de Recurso</label>
                                    <select class="form-control" id="wizardTipoRecurso" name="tipo_recurso_id">
                                        <option value="">Seleccione un tipo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardColeccion">Colección</label>
                                    <select class="form-control" id="wizardColeccion" name="coleccion_id">
                                        <option value="">Seleccione una colección</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="wizardResumen">Resumen</label>
                            <textarea class="form-control" id="wizardResumen" name="resumen" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="wizardArchivo">Archivo PDF <span class="text-danger">*</span></label>
                            <input type="file" class="form-control-file" id="wizardArchivo" name="archivo" accept=".pdf"
                                required>
                            <small class="form-text text-muted">Solo archivos PDF</small>
                        </div>
                        <div id="wizardArchivoPreview" class="mt-3"></div>

                        <!-- Sección de Autores -->
                        <hr class="my-4">
                        <h6 class="mb-3"><i class="fas fa-users"></i> Autores del Documento</h6>
                        <div id="wizardAutoresList" class="mb-3"></div>
                        <button type="button" class="btn btn-sm btn-primary" id="btnAgregarAutor">
                            <i class="fas fa-plus"></i> Agregar Autor
                        </button>
                    </div>

                    <!-- Paso 2: Proyecto -->
                    <div class="wizard-step d-none" id="step2" data-step="2">
                        <h5 class="mb-3"><i class="fas fa-project-diagram"></i> Paso 2: Crear Proyecto</h5>
                        <div class="form-group">
                            <label for="wizardTipoProyecto">Tipo de Proyecto <span class="text-danger">*</span></label>
                            <select class="form-control" id="wizardTipoProyecto" name="tipo_proyecto_id" required>
                                <option value="">Seleccione un tipo de proyecto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="wizardDescripcionProyecto">Descripción del Proyecto</label>
                            <textarea class="form-control" id="wizardDescripcionProyecto" name="descripcion"
                                rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardEstadoProyecto">Estado</label>
                                    <select class="form-control" id="wizardEstadoProyecto" name="estado">
                                        <option value="borrador">Borrador</option>
                                        <option value="en_revision">En Revisión</option>
                                        <option value="aprobado">Aprobado</option>
                                        <option value="publicado">Publicado</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardVisibilidadProyecto">Visibilidad</label>
                                    <select class="form-control" id="wizardVisibilidadProyecto" name="visibilidad">
                                        <option value="publico">Público</option>
                                        <option value="privado">Privado</option>
                                        <option value="restringido">Restringido</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 3: Publicación -->
                    <div class="wizard-step d-none" id="step3" data-step="3">
                        <h5 class="mb-3"><i class="fas fa-book"></i> Paso 3: Crear Publicación</h5>
                        <div class="form-group">
                            <label for="wizardTipoPublicacion">Tipo de Publicación</label>
                            <select class="form-control" id="wizardTipoPublicacion" name="tipo_publicacion">
                                <option value="repositorio">Repositorio</option>
                                <option value="revista">Revista</option>
                                <option value="libro">Libro</option>
                                <option value="congreso">Congreso</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardEstadoPublicacion">Estado</label>
                                    <select class="form-control" id="wizardEstadoPublicacion" name="estado_publicacion">
                                        <option value="borrador">Borrador</option>
                                        <option value="en_proceso">En Proceso</option>
                                        <option value="publicada">Publicada</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="wizardFechaPublicacion">Fecha de Publicación</label>
                                    <input type="date" class="form-control" id="wizardFechaPublicacion"
                                        name="fecha_publicacion">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="wizardCategorias">Categorías</label>
                            <select class="form-control select2" id="wizardCategorias" name="categorias_ids" multiple
                                style="width: 100%;">
                            </select>
                            <small class="form-text text-muted">Seleccione una o más categorías</small>
                        </div>
                        <div class="form-group">
                            <label for="wizardEtiquetas">Etiquetas</label>
                            <select class="form-control select2" id="wizardEtiquetas" name="etiquetas_ids" multiple
                                style="width: 100%;">
                            </select>
                            <small class="form-text text-muted">Seleccione una o más etiquetas</small>
                        </div>
                        <div class="form-group">
                            <label for="wizardUrlExterna">URL Externa</label>
                            <div class="input-group">
                                <input type="url" class="form-control" id="wizardUrlExterna" name="url_externa"
                                    placeholder="https://ejemplo.com/publicacion">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="btnWizardGenerarUrl">
                                        <i class="fas fa-link"></i> Generar URL
                                    </button>
                                </div>
                            </div>
                            <small class="form-text text-muted">URL externa de la publicación (opcional)</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnWizardAnterior" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" id="btnWizardSiguiente">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
                <button type="button" class="btn btn-primary" id="btnWizardFinalizar" style="display: none;">
                    <i class="fas fa-check"></i> Finalizar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Agregar Autor -->
<div class="modal fade" id="modalAgregarAutor" tabindex="-1" role="dialog" aria-labelledby="modalAgregarAutorLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAgregarAutorLabel">Agregar Autor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="formAgregarAutor">
                <div class="modal-body">
                    <div class="form-group">
                        <label>¿El autor es usuario del sistema?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="autorTipo" id="autorUsuario"
                                value="usuario" checked>
                            <label class="form-check-label" for="autorUsuario">
                                Sí, es usuario
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="autorTipo" id="autorNoUsuario"
                                value="no_usuario">
                            <label class="form-check-label" for="autorNoUsuario">
                                No, no es usuario
                            </label>
                        </div>
                    </div>

                    <!-- Campos para autor-usuario -->
                    <div id="autorUsuarioFields">
                        <div class="form-group">
                            <label for="autorUsuarioSelect">Seleccionar Usuario <span
                                    class="text-danger">*</span></label>
                            <select class="form-control" id="autorUsuarioSelect" name="usuario_id">
                                <option value="">Seleccione un usuario</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="autorUsuarioAfiliacion">Afiliación</label>
                            <input type="text" class="form-control" id="autorUsuarioAfiliacion" name="afiliacion"
                                placeholder="Institución o afiliación">
                        </div>
                        <div class="form-group">
                            <label for="autorUsuarioOrcid">ORCID ID</label>
                            <input type="text" class="form-control" id="autorUsuarioOrcid" name="orcid_id"
                                placeholder="0000-0000-0000-0000" maxlength="19">
                        </div>
                    </div>

                    <!-- Campos para autor-no-usuario -->
                    <div id="autorNoUsuarioFields" style="display: none;">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="autorNombre">Nombre <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="autorNombre" name="nombre"
                                        placeholder="Nombre">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="autorApellidos">Apellidos <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="autorApellidos" name="apellidos"
                                        placeholder="Apellidos">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="autorEmail">Email</label>
                            <input type="email" class="form-control" id="autorEmail" name="email"
                                placeholder="email@ejemplo.com">
                        </div>
                        <div class="form-group">
                            <label for="autorAfiliacion">Afiliación</label>
                            <input type="text" class="form-control" id="autorAfiliacion" name="afiliacion"
                                placeholder="Institución o afiliación">
                        </div>
                        <div class="form-group">
                            <label for="autorOrcid">ORCID ID</label>
                            <input type="text" class="form-control" id="autorOrcid" name="orcid_id"
                                placeholder="0000-0000-0000-0000" maxlength="19">
                        </div>
                    </div>

                    <!-- Campos comunes -->
                    <div class="form-group">
                        <label for="autorOrden">Orden de Autoría</label>
                        <input type="number" class="form-control" id="autorOrden" name="orden_autor" value="1" min="1">
                        <small class="form-text text-muted">1 = primer autor</small>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="autorCorrespondiente"
                                name="es_correspondiente" value="true">
                            <label class="form-check-label" for="autorCorrespondiente">
                                Autor de correspondencia
                            </label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="autorPrincipal"
                                name="es_autor_principal" value="true">
                            <label class="form-check-label" for="autorPrincipal">
                                Autor principal
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Agregar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Este bloque se ejecutará antes de jQuery, así que lo dejamos vacío aquí -->
{% endblock %}

{% include 'Nucleo/abajo.html' %}

<!-- Select2 y Wizard Rapido - Cargar después de jQuery -->
<script>
    // Esperar a que jQuery esté disponible antes de cargar select2
    (function () {
        function loadScripts() {
            if (typeof jQuery === 'undefined') {
                setTimeout(loadScripts, 50);
                return;
            }

            // jQuery está disponible, cargar select2
            var script1 = document.createElement('script');
            script1.src = "{% static 'plugins/select2/js/select2.full.min.js' %}";
            script1.onload = function () {
                // Después de select2, cargar wizard_rapido.js
                var script2 = document.createElement('script');
                script2.src = "{% static 'js/wizard_rapido.js' %}";
                document.body.appendChild(script2);
            };
            document.body.appendChild(script1);
        }

        // Esperar a que el DOM esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadScripts);
        } else {
            loadScripts();
        }
    })();
</script>
